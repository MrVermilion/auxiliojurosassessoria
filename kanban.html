<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8"> <!-- Define a codificação de caracteres para UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Configura o viewport para responsividade -->
    <title>Quadro Kanban</title> <!-- Título da página -->

    <!-- Fonte e estilo -->
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600&display=swap" rel="stylesheet">
    <!-- Inclui a fonte Titillium Web -->
    <link rel="stylesheet" href="style-kanban.css"> <!-- Link para o arquivo de estilo CSS -->

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> <!-- Inclui a biblioteca Supabase -->
    <script>
        var client = false;
        var SUPABASE_INSTANCE = callInstanceSupabase();

        function getTokenSupabase() {
            return "SEU_TOKEN_SUPABASE"; // Retorna o token para autenticação no Supabase
        }

        function getUrlApiSupabase() {
            return "https://mkdjulwrizgwshzsnafm.supabase.co"; // URL da API do Supabase
        }

        function callInstanceSupabase() {
            if (!client) {
                let { createClient } = supabase;
                let url = getUrlApiSupabase();
                client = createClient(url, getTokenSupabase()); // Cria a instância do Supabase
            }
            return client;
        }

        async function carregarClientes() {
            let { data: clientes, error } = await SUPABASE_INSTANCE
                .from('cadastros') // Nome da tabela no Supabase
                .select('id, usunome'); // Seleciona os campos 'id' e 'usunome'

            if (error) {
                console.error("Erro ao carregar clientes: ", error.message); // Exibe erro no console
                return;
            }

            const colunaClientes = document.querySelector('#coluna-clientes');
            clientes.forEach(cliente => {
                const clienteItem = document.createElement('div');
                clienteItem.className = 'cliente-item';
                clienteItem.draggable = true; // Permite arrastar o item
                clienteItem.textContent = cliente.usunome;
                clienteItem.dataset.id = cliente.id;
                clienteItem.addEventListener('dragstart', dragStart); // Adiciona evento de arrastar
                colunaClientes.appendChild(clienteItem); // Adiciona o item à coluna de clientes
            });
        }

        function dragStart(event) {
            event.dataTransfer.setData("text", event.target.dataset.id); // Define os dados para transferência
            event.dataTransfer.setData("text/nome", event.target.textContent);
        }

        function allowDrop(event) {
            event.preventDefault(); // Permite soltar o item
        }

        function drop(event, coluna) {
            event.preventDefault();
            const idCliente = event.dataTransfer.getData("text");
            const nomeCliente = event.dataTransfer.getData("text/nome");

            const itemMovido = document.querySelector(`[data-id="${idCliente}"]`);
            const novaColuna = document.getElementById(coluna);
            if (itemMovido) {
                novaColuna.appendChild(itemMovido); // Move o item para a nova coluna
            }
        }

        document.addEventListener('DOMContentLoaded', carregarClientes); // Carrega os clientes quando a página é carregada
    </script>
</head>

<body>
    <header>
        <h1>Quadro Kanban</h1> <!-- Cabeçalho com o título da página -->
    </header>
    <div class="container">
        <nav class="menu">
            <ul>
                <li><a href="index.html">Página Inicial</a></li>
                <li><a href="cadastros.html">Cadastros</a></li>
                <li><a href="tarefas.html">Tarefas</a></li>
                <li><a href="clientes.html">Clientes</a></li>
                <li><a href="documentos.html">Documentos</a></li>
                <li><a href="kanban.html">Kanban</a></li> <!-- Links para outras páginas -->
            </ul>
        </nav>
        <div class="kanban-board">
            <div class="kanban-column" id="coluna-clientes" ondrop="drop(event, 'coluna-clientes')"
                ondragover="allowDrop(event)">
                <h2>Nome do Cliente</h2> <!-- Coluna para nomes dos clientes -->
            </div>
            <div class="kanban-column" id="coluna-a-fazer" ondrop="drop(event, 'coluna-a-fazer')"
                ondragover="allowDrop(event)">
                <h2>A Fazer</h2> <!-- Coluna de tarefas a fazer -->
            </div>
            <div class="kanban-column" id="coluna-fazendo" ondrop="drop(event, 'coluna-fazendo')"
                ondragover="allowDrop(event)">
                <h2>Fazendo</h2> <!-- Coluna de tarefas em andamento -->
            </div>
            <div class="kanban-column" id="coluna-feito" ondrop="drop(event, 'coluna-feito')"
                ondragover="allowDrop(event)">
                <h2>Feito</h2> <!-- Coluna de tarefas concluídas -->
            </div>
        </div>
    </div>
</body>

</html>